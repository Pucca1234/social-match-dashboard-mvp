## 📊 Social Match Analytics Dashboard (MVP)

Supabase(BigQuery 연결)를 기반으로 한  
소셜 매치 데이터 이상 탐지/분석용 MVP 대시보드입니다.

---

## ✅ 현재 구현된 기능 (2026-01 기준)

### 1. 데이터 소스
- Supabase + BigQuery 연동
- schema: `bigquery`
- 주요 테이블:
  - `data_mart_1_social_match`
  - `metric_store_native`

### 2. API 엔드포인트
- `GET /api/weeks`
  - 주 단위(`week`) 라벨 전체 목록 반환
- `GET /api/metrics`
  - 지표 사전 (metric id / 한글명 / 설명)
- `POST /api/heatmap`
  - 측정단위 / 필터 / 주 목록 기준 히트맵 데이터 반환

### 3. UI (단일 페이지)
- 주 단위 데이터가 **우측으로 펼쳐지는 히트맵 테이블**
- 측정단위 드릴다운 구조
  - 전체 → Area group → Area → Stadium group → Stadium
- 이상치 기반 점수 계산 및 정렬
- Insights 패널 (요약 / 다음 드릴다운 제안)

### 4. 현재 확인된 상태
- Supabase 실데이터 정상 조회 확인
- `/api/weeks`, `/api/metrics` 정상 응답
- Heatmap 데이터 렌더링 정상
- 일부 지표 값(진행률 등)이 100%로만 표시되는 현상 → **SQL 검증 예정**

---

## 🔧 로컬 실행 방법

```bash
npm install
npm run dev
```

## ? 오늘 작업 (2026-01-20)

이번 작업은 “지표 중심 분석” 흐름을 강화하고, 데이터 최신성/디버깅을 명확히 하는 데 집중했습니다.  
아래는 변경의 이유/내용/방식 요약입니다.

### 1) 왜
- 초기 진입 시 자동 로드로 인해 사용 흐름이 모호했고, 최근 주차 판단이 데이터셋 기준으로 치우치는 문제가 있었습니다.
- 지표 중심 분석 UX를 강화하고, 문제 상황을 즉시 확인할 수 있는 디버깅 패널이 필요했습니다.

### 2) 무엇을
- 프로젝트명 **Kevin**으로 일관 변경 (메타 타이틀/헤더 포함)
- 자동 로드 제거 → **옵션 선택 후 ‘조회하기’ 클릭 시에만 로드**
- 최근 8/12주 범위를 **오늘 기준 과거 데이터만** 포함하도록 보정 (미래 주차 제외)
- **지표 다중 선택 + 핵심 지표 1개 선택** UI 추가, 지표 설명 툴팁 제공
- 결과 테이블을 **엔티티 요약 + 지표별 행** 구조로 재구성 (스파크라인/증감 표시 포함)
- 우측 하단 **Error Log 토글** 추가 (API/콘솔 오류 디버깅용)

### 3) 어떻게
- `/api/heatmap`는 선택된 지표만 조회하도록 최적화
- 주차 리스트는 “오늘 기준 최근 n주”만 산출하고, UI는 조회 버튼 이후에만 갱신
- 스파크라인/증감은 동일 행 내 주차 흐름을 기준으로 계산

### 4) Supabase 연동 주의사항
- `.env.local`에 아래 키를 설정해야 합니다. **민감값은 저장소에 커밋 금지**
  - `SUPABASE_URL`
  - `SUPABASE_SERVICE_ROLE_KEY`

---
